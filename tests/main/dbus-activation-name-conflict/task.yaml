summary: Test handling of D-Bus service name conflicts

execute: |
    #shellcheck source=tests/lib/snaps.sh
    . "$TESTSLIB"/snaps.sh

    echo "Install a snap that provides the io.snapcraft.SnapDbusService session service"
    snap install --edge test-snapd-dbus-service
    [ -f /var/lib/snapd/dbus/services/io.snapcraft.SnapDbusService.service ]

    echo "Installing a second snap that tries to provide the name fails"
    ! install_local test-snapd-dbus-service-conflicting

    echo "But refreshing a snap providing a name should work"
    snap install --dangerous /var/lib/snapd/snaps/test-snapd-dbus-service_*.snap
